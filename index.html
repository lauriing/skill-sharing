<!DOCTYPE html>
<html>
<head>
  <title>Individualis - Skill Sharing Website</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/html5up-stellar/1.0.0/assets/css/main.css" />
  <style>
    html, body {
      height: 100vh;
      margin: 0;
      padding: 0;
    }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    #registerPage {
      width: 100%;
      max-width: 400px;
      display: none;
    }
    #registerPage.active {
      display: block;
    }
    #homePage {
      display: none;
      width: 100vw;
    }
    #homePage.active {
      display: block;
    }
    #usersPage {
      display: none;
      width: 100vw;
      text-align: center;
    }
    #usersPage.active {
      display: block;
    }
    .form-label {
      font-weight: bold;
      margin-bottom: 0.2em;
      display: block;
    }
    .form-group {
      margin-bottom: 1em;
      width: 100%;
      max-width: 350px;
    }
    .user { border: 1px solid #e5e5e5; border-radius: 8px; padding: 1em; margin-bottom: 1em; background: #fff; }
    .success { color: #27ae60; }
    .error { color: #c0392b; }
    .pointer { cursor: pointer; }
    .autocomplete-items {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      top: 100%;
      left: 0;
      right: 0;
      background: #fff;
      max-height: 150px;
      overflow-y: auto;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }
    .autocomplete-items div:hover {
      background-color: #e9e9e9;
    }
    .autocomplete-active {
      background-color: #1e90ff !important;
      color: #ffffff;
    }
    .flex-center-row {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      margin-bottom: 2em;
      margin-top: 2em;
    }
    #searchSkillContainer {
      position: absolute;
      top: 30px;
      right: 40px;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    @media (max-width: 900px) {
      .flex-center-row {
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }
      #searchSkillContainer {
        position: static;
        margin-bottom: 1em;
        justify-content: flex-end;
        width: 100%;
      }
    }
    .title-link {
      color: inherit;
      text-decoration: none;
      cursor: pointer;
      font-size: 2.5em;
      font-weight: bold;
      letter-spacing: 2px;
      display: block;
      margin-bottom: 0.2em;
    }
    .center-title {
      position: absolute;
      left: 50%;
      top: 20px;
      transform: translateX(-50%);
      text-align: center;
      z-index: 101;
    }
    .subtitle {
      position: absolute;
      left: 50%;
      top: 70px;
      transform: translateX(-50%);
      text-align: center;
      z-index: 101;
      font-size: 1.2em;
      color: #666;
      margin: 0;
      padding: 0;
      font-weight: normal;
      letter-spacing: 1px;
    }
    #registerBtn {
      background: #1e90ff;
      color: #fff;
      border: none;
      padding: 0.5em 1.2em;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1em;
      margin-left: 10px;
    }
    #registerBtn:hover {
      background: #176dc1;
    }
    #usersBackBtn {
      margin: 2em auto 1em auto;
      display: block;
    }
    #toggleUsersBtn, #showAllUsersBtn {
      display: block;
      margin: 2em auto 0 auto;
    }
  </style>
</head>
<body class="is-preload">
  <div id="registerPage">
    <!-- Header -->
    <a class="title-link center-title" id="titleLink">Individualis</a>
    <div class="subtitle">You give skill, I take your skill</div>
    <form id="registerForm" style="width:100%;max-width:400px;margin-top:120px;">
      <div class="form-group">
        <label class="form-label" for="name">Name:</label>
        <input type="text" id="name" required class="input" />
      </div>
      <div class="form-group">
        <label class="form-label" for="discord">Discord Username:</label>
        <input type="text" id="discord" required class="input" />
      </div>
      <div class="form-group">
        <label class="form-label" for="skillsOffered">What skills do you offer?</label>
        <input type="text" id="skillsOffered" placeholder="WHATEVER U GOT MANE" required class="input" />
      </div>
      <div class="form-group">
        <label class="form-label" for="skillsWanted">What skills do you want to learn from others?</label>
        <input type="text" id="skillsWanted" placeholder="WHATEVER U WANT MANE" required class="input" />
      </div>
      <button type="submit" class="button primary fit">Register</button>
      <div id="registerMsg"></div>
    </form>
  </div>

  <!-- Home Page -->
  <div id="homePage">
    <!-- Centered Title and Subtitle -->
    <a class="title-link center-title" id="titleLink2">Individualis</a>
    <div class="subtitle">You give skill, I take your skill</div>
    <!-- Search Skill Top Right + Register Button -->
    <div id="searchSkillContainer">
      <input type="text" id="searchSkill" placeholder="Enter skill" autocomplete="off" />
      <button onclick="searchSkill()" class="button small" type="button">Search</button>
      <button id="registerBtn" type="button">Register</button>
      <div id="autocomplete-list" class="autocomplete-items"></div>
    </div>
    <section class="container" style="margin-top:120px;">
      <div class="flex-center-row">
        <!-- Add Skill Offered -->
        <section class="section" style="min-width:300px;">
          <h2>Add Skill Offered</h2>
          <form id="offerForm">
            <div class="row gtr-uniform">
              <div class="col-12">
                <input type="text" id="offerUser" placeholder="User Name" required />
              </div>
              <div class="col-12">
                <input type="text" id="offerSkill" placeholder="Skill" required />
              </div>
              <div class="col-12">
                <input type="text" id="offerDesc" placeholder="Skill Description" required />
              </div>
              <div class="col-12">
                <button type="submit" class="button fit">Add</button>
              </div>
            </div>
          </form>
          <div id="offerMsg"></div>
        </section>

        <!-- Add Skill Wanted -->
        <section class="section" style="min-width:300px;">
          <h2>Add Skill Wanted</h2>
          <form id="wantForm">
            <div class="row gtr-uniform">
              <div class="col-12">
                <input type="text" id="wantUser" placeholder="User Name" required />
              </div>
              <div class="col-12">
                <input type="text" id="wantSkill" placeholder="Skill" required />
              </div>
              <div class="col-12">
                <button type="submit" class="button fit">Add</button>
              </div>
            </div>
          </form>
          <div id="wantMsg"></div>
        </section>
      </div>
      <div id="searchResult"></div>
      <!-- Show All Users as a new page, centered -->
      <button id="showAllUsersBtn" class="button small">Show All Users</button>
    </section>
  </div>

  <!-- Users Page (full page for all users) -->
  <div id="usersPage">
    <a class="title-link center-title" id="titleLink3">Individualis</a>
    <div class="subtitle">You give skill, I take your skill</div>
    <button id="usersBackBtn" class="button small" style="margin-top:120px;">Back</button>
    <h2>All Users</h2>
    <div id="usersFull"></div>
  </div>

  <!-- Footer -->
  <footer id="footer" class="center">
    <p></p>
  </footer>

  <!-- Scripts -->
  <script>
    let users = [];

    function saveUsers() {
      localStorage.setItem('skillSharingUsers', JSON.stringify(users));
    }

    function loadUsers() {
      const data = localStorage.getItem('skillSharingUsers');
      users = data ? JSON.parse(data) : [];
    }

    function showRegisterPage(pushState = true) {
      document.body.style.flexDirection = "column";
      document.getElementById('registerPage').classList.add('active');
      document.getElementById('homePage').classList.remove('active');
      document.getElementById('usersPage').classList.remove('active');
      if (pushState) location.hash = "#register";
    }

    function showHomePage(pushState = true) {
      document.body.style.flexDirection = "unset";
      document.getElementById('registerPage').classList.remove('active');
      document.getElementById('homePage').classList.add('active');
      document.getElementById('usersPage').classList.remove('active');
      displayUsers();
      updateAutocomplete();
      if (pushState) location.hash = "#home";
    }

    function showUsersPage(pushState = true) {
      document.body.style.flexDirection = "unset";
      document.getElementById('registerPage').classList.remove('active');
      document.getElementById('homePage').classList.remove('active');
      document.getElementById('usersPage').classList.add('active');
      displayUsersFull();
      if (pushState) location.hash = "#users";
    }

    function displayUsers() {
      let html = '';
      users.forEach(user => {
        html += `<div class="user">
          <b>${user.name}</b> (Discord: ${user.discord})<br>
          <strong>Offers:</strong> <ul>${user.skillsOffered.map(s => `<li>${s.name} - ${s.description}</li>`).join('')}</ul>
          <strong>Wants:</strong> ${user.skillsWanted.join(', ')}
        </div>`;
      });
      document.getElementById('users') && (document.getElementById('users').innerHTML = html || "<i>No users registered yet.</i>");
    }

    function displayUsersFull() {
      let html = '';
      users.forEach(user => {
        html += `<div class="user">
          <b>${user.name}</b> (Discord: ${user.discord})<br>
          <strong>Offers:</strong> <ul>${user.skillsOffered.map(s => `<li>${s.name} - ${s.description}</li>`).join('')}</ul>
          <strong>Wants:</strong> ${user.skillsWanted.join(', ')}
        </div>`;
      });
      document.getElementById('usersFull').innerHTML = html || "<i>No users registered yet.</i>";
    }

    document.getElementById('registerForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('name').value.trim();
      let discord = document.getElementById('discord').value.trim();
      let skillsOfferedInput = document.getElementById('skillsOffered').value.trim();
      let skillsWantedInput = document.getElementById('skillsWanted').value.trim();
      let msg = document.getElementById('registerMsg');
      if (users.some(u => u.name.toLowerCase() === name.toLowerCase())) {
        msg.innerHTML = "<span class='error'>User already exists.</span>";
        return;
      }
      let skillsOffered = skillsOfferedInput.split(',').map(s => {
        let parts = s.split(':');
        return { name: (parts[0] || '').trim(), description: (parts[1] || '').trim() };
      }).filter(s => s.name);
      let skillsWanted = skillsWantedInput.split(',').map(s => s.trim()).filter(s => s);
      users.push({ name, discord, skillsOffered, skillsWanted });
      msg.innerHTML = "<span class='success'>User registered!</span>";
      saveUsers();
      setTimeout(() => { msg.innerHTML = ""; showHomePage(); }, 1000);
    };

    document.getElementById('offerForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('offerUser').value.trim();
      let skill = document.getElementById('offerSkill').value.trim();
      let desc = document.getElementById('offerDesc').value.trim();
      let msg = document.getElementById('offerMsg');
      let user = users.find(u => u.name.toLowerCase() === name.toLowerCase());
      if (user) {
        if (!user.skillsOffered.some(s => s.name.toLowerCase() === skill.toLowerCase())) {
          user.skillsOffered.push({ name: skill, description: desc });
          msg.innerHTML = "<span class='success'>Skill added!</span>";
          saveUsers();
          displayUsers();
          updateAutocomplete();
          this.reset();
        } else {
          msg.innerHTML = "<span class='error'>Skill already exists for this user.</span>";
        }
      } else {
        msg.innerHTML = "<span class='error'>User not found.</span>";
      }
      setTimeout(() => { msg.innerHTML = ""; }, 2000);
    };

    document.getElementById('wantForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('wantUser').value.trim();
      let skill = document.getElementById('wantSkill').value.trim();
      let msg = document.getElementById('wantMsg');
      let user = users.find(u => u.name.toLowerCase() === name.toLowerCase());
      if (user) {
        if (!user.skillsWanted.includes(skill)) user.skillsWanted.push(skill);
        msg.innerHTML = "<span class='success'>Skill added!</span>";
        saveUsers();
        displayUsers();
        this.reset();
      } else {
        msg.innerHTML = "<span class='error'>User not found.</span>";
      }
      setTimeout(() => { msg.innerHTML = ""; }, 2000);
    };

    // --- AUTOCOMPLETE FOR SEARCH SKILL ---
    function updateAutocomplete() {
      let allSkills = [];
      users.forEach(u => u.skillsOffered.forEach(s => {
        if (!allSkills.includes(s.name)) allSkills.push(s.name);
      }));
      autocomplete(document.getElementById('searchSkill'), allSkills);
    }

    function autocomplete(inp, arr) {
      let currentFocus;
      inp.addEventListener("input", function(e) {
        let a, b, i, val = this.value;
        closeAllLists();
        if (!val) { return false;}
        currentFocus = -1;
        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        this.parentNode.appendChild(a);
        for (i = 0; i < arr.length; i++) {
          if (arr[i].toLowerCase().indexOf(val.toLowerCase()) !== -1) {
            b = document.createElement("DIV");
            b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
            b.innerHTML += arr[i].substr(val.length);
            b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
            b.addEventListener("click", function(e) {
                inp.value = this.getElementsByTagName("input")[0].value;
                closeAllLists();
            });
            a.appendChild(b);
          }
        }
      });
      inp.addEventListener("keydown", function(e) {
        let x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
          currentFocus++;
          addActive(x);
        } else if (e.keyCode == 38) {
          currentFocus--;
          addActive(x);
        } else if (e.keyCode == 13) {
          e.preventDefault();
          if (currentFocus > -1) {
            if (x) x[currentFocus].click();
          }
        }
      });
      function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
        for (let i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
        let x = document.getElementsByClassName("autocomplete-items");
        for (let i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
            x[i].parentNode.removeChild(x[i]);
          }
        }
      }
      document.addEventListener("click", function (e) {
        closeAllLists(e.target);
      });
    }

    function searchSkill() {
      let skill = document.getElementById('searchSkill').value.trim();
      let resultDiv = document.getElementById('searchResult');
      let foundUsers = users.filter(user =>
        user.skillsOffered.some(s => s.name.toLowerCase() === skill.toLowerCase())
      );
      if (foundUsers.length > 0) {
        resultDiv.innerHTML = foundUsers.map(user =>
          `<div class="user">
            <b>${user.name}</b> (Discord: ${user.discord})<br>
            <strong>Offers:</strong> <ul>${user.skillsOffered.map(s => `<li>${s.name} - ${s.description}</li>`).join('')}</ul>
            <strong>Wants:</strong> ${user.skillsWanted.join(', ')}
          </div>`
        ).join('');
      } else {
        resultDiv.innerHTML = "<span class='error'>No users found offering that skill.</span>";
      }
    }

    // Show All Users as a new page
    document.getElementById('showAllUsersBtn').onclick = function() {
      showUsersPage();
    };

    // Users page back button
    document.getElementById('usersBackBtn').onclick = function() {
      showHomePage();
    };

    // Title click handlers
    document.getElementById('titleLink').onclick = function() {
      showHomePage();
    };
    document.getElementById('titleLink2').onclick = function() {
      showHomePage();
    };
    document.getElementById('titleLink3').onclick = function() {
      showHomePage();
    };

    // Register button handler
    document.getElementById('registerBtn').onclick = function() {
      showRegisterPage();
    };

    // Handle navigation with hash
    function handleHash() {
      if (location.hash === "#register") {
        showRegisterPage(false);
      } else if (location.hash === "#users") {
        showUsersPage(false);
      } else {
        showHomePage(false);
      }
    }

    // Listen for hash changes (back/forward navigation)
    window.addEventListener('hashchange', handleHash);

    // On load
    loadUsers();
    handleHash();
    updateAutocomplete();
  </script>
</body>
</html>