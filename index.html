<!DOCTYPE html>
<html>
<head>
  <title> Genius Society</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/html5up-stellar/1.0.0/assets/css/main.css" />
  <style>
    html, body {
      height: 100vh;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #2d174c; /* Deep purple background */
      color: #f3e8ff;
    }
    body {
      min-height: 100vh;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #6d28d9 0%, #a78bfa 100%);
    }
    #registerPage, #addSkillPage, #usersPage {
      display: none;
      height: 100vh;
      overflow: auto;
    }
    #registerPage.active, #addSkillPage.active, #usersPage.active {
      display: block;
    }
    #registerContainer {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: none;
    }
    #registerBox {
      width: 100%;
      max-width: 400px;
      background: rgba(103, 58, 183, 0.95); /* purple */
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(103,58,183,0.18);
      padding-bottom: 30px;
      color: #f3e8ff;
    }
    .side-img {
      width: 200px;
      height: auto;
      margin: 0 30px;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(103,58,183,0.18);
    }
    @media (max-width: 900px) {
      #registerContainer {
        flex-direction: column;
      }
      .side-img {
        margin: 20px 0;
        width: 80vw;
        max-width: 300px;
      }
    }
    .title-link {
      color: #fff;
      text-decoration: none;
      cursor: pointer;
      font-size: 2.5em;
      font-weight: bold;
      letter-spacing: 2px;
      display: block;
      margin-bottom: 0.2em;
      text-shadow: 0 2px 8px #6d28d9;
    }
    .center-title {
      position: static;
      text-align: center;
      z-index: 101;
    }
    .subtitle {
      text-align: center;
      font-size: 1.2em;
      color: #d1c4e9;
      margin: 0 0 30px 0;
      padding: 0;
      font-weight: normal;
      letter-spacing: 1px;
    }
    #registerMsg {
      text-align: center;
      margin-top: 10px;
      color: #fff;
    }
    .form-group {
      margin-bottom: 1em;
      width: 100%;
      max-width: 350px;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }
    .form-label {
      font-weight: bold;
      margin-bottom: 0.2em;
      display: block;
      text-align: center;
      white-space: nowrap;
      color: #ede9fe;
    }
    .input, input[type="text"] {
      width: 90%;
      padding: 0.7em;
      border-radius: 8px;
      border: 1px solid #a78bfa;
      background: #ede9fe;
      color: #4b2067;
      margin-bottom: 0.5em;
      font-size: 1em;
      outline: none;
      transition: border 0.2s;
    }
    .input:focus, input[type="text"]:focus {
      border: 2px solid #7c3aed;
      background: #fff;
      color: #4b2067;
    }
    .button.primary.fit, .button.fit {
      display: block;
      margin: 0 auto;
      background: linear-gradient(90deg, #7c3aed 0%, #a78bfa 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.7em 2em;
      font-size: 1.1em;
      font-weight: bold;
      box-shadow: 0 2px 8px #a78bfa44;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .button.primary.fit:hover, .button.fit:hover {
      background: linear-gradient(90deg, #a78bfa 0%, #7c3aed 100%);
      box-shadow: 0 4px 16px #a78bfa66;
    }
    #usersBackBtn {
      margin: 2em auto 1em auto;
      display: block;
      background: #7c3aed;
      color: #fff;
    }
    #showAllUsersBtn {
      display: block;
      margin: 2em auto 0 auto;
      background: #a78bfa;
      color: #4b2067;
    }
    .user {
      border: 1px solid #a78bfa;
      border-radius: 8px;
      padding: 1em;
      margin-bottom: 1em;
      background: #ede9fe;
      color: #4b2067;
      box-shadow: 0 2px 8px #a78bfa22;
    }
    .success { color: #b4f5c1; }
    .error { color: #ffb4d4; }
    .pointer { cursor: pointer; }
    .autocomplete-items {
      position: absolute;
      border: 1px solid #a78bfa;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      top: 100%;
      left: 0;
      right: 0;
      background: #ede9fe;
      max-height: 150px;
      overflow-y: auto;
      color: #4b2067;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #ede9fe;
      border-bottom: 1px solid #a78bfa;
    }
    .autocomplete-items div:hover {
      background-color: #c4b5fd;
    }
    .autocomplete-active {
      background-color: #7c3aed !important;
      color: #fff;
    }
    .flex-center-row {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      margin-bottom: 2em;
      margin-top: 2em;
      margin-left: 100px;
    }
    @media (max-width: 900px) {
      .flex-center-row {
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }
    }
  </style>
</head>
<body class="is-preload">
  <!-- Register Session -->
  <div id="registerPage" class="active">
    <div id="registerContainer">
      <img src="pictures/zani.gif" alt="Side GIF" class="side-img" />
      <div id="registerBox">
        <a class="title-link center-title" id="titleLink">Individualis</a>
        <div class="subtitle">You give skill, I take your skill</div>
        <form id="registerForm" style="width:100%;max-width:400px;margin-top:30px;">
          <div class="form-group">
            <label class="form-label" for="name">Name:</label>
            <input type="text" id="name" required class="input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="discord">Discord Username:</label>
            <input type="text" id="discord" required class="input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="skillsOffered">What skills do you offer?</label>
            <input type="text" id="skillsOffered" placeholder="WHATEVER U GOT MANE" required class="input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="skillsWanted" style="text-align:center; display:block; width:100%; white-space:nowrap;">
              What skills do you want to learn from others?
            </label>
            <input type="text" id="skillsWanted" placeholder="WHATEVER U WANT MANE" required class="input" />
          </div>
          <button type="submit" class="button primary fit">Register</button>
          <div id="registerMsg"></div>
        </form>
      </div>
      <img src="pictures/zani.gif" alt="Side GIF" class="side-img" />
    </div>
  </div>

  <!-- Add Skill Session -->
  <div id="addSkillPage">
    <a class="title-link center-title" id="titleLink2">Individualis</a>
    <div class="subtitle">You give skill, I take your skill</div>
    <section class="container">
      <div class="flex-center-row">
        <!-- Add Skill Offered -->
        <section class="section" style="min-width:300px;">
          <h2>Add Skill Offered</h2>
          <form id="offerForm">
            <div class="row gtr-uniform">
              <div class="col-12">
                <input type="text" id="offerUser" placeholder="User Name" required />
              </div>
              <div class="col-12">
                <input type="text" id="offerSkill" placeholder="Skill" required />
              </div>
              <div class="col-12">
                <input type="text" id="offerDesc" placeholder="Skill Description" required />
              </div>
              <div class="col-12">
                <button type="submit" class="button fit">Add</button>
              </div>
            </div>
          </form>
          <div id="offerMsg"></div>
        </section>
        <!-- Add Skill Wanted -->
        <section class="section" style="min-width:300px;">
          <h2>Add Skill Wanted</h2>
          <form id="wantForm">
            <div class="row gtr-uniform">
              <div class="col-12">
                <input type="text" id="wantUser" placeholder="User Name" required />
              </div>
              <div class="col-12">
                <input type="text" id="wantSkill" placeholder="Skill" required />
              </div>
              <div class="col-12">
                <button type="submit" class="button fit">Add</button>
              </div>
            </div>
          </form>
          <div id="wantMsg"></div>
        </section>
      </div>
      <div id="searchResult"></div>
      <button id="showAllUsersBtn" class="button small">Show All Users</button>
    </section>
  </div>

  <!-- Show All Users Session -->
  <div id="usersPage">
    <a class="title-link center-title" id="titleLink3">Individualis</a>
    <div class="subtitle">You give skill, I take your skill</div>
    <button id="usersBackBtn" class="button small" style="margin-top:120px;">Back</button>
    <h2>All Users</h2>
    <div id="usersFull"></div>
  </div>

  <script>
    let users = [];

    function saveUsers() {
      localStorage.setItem('skillSharingUsers', JSON.stringify(users));
    }

    function loadUsers() {
      const data = localStorage.getItem('skillSharingUsers');
      users = data ? JSON.parse(data) : [];
    }

    function showRegisterPage(pushState = true) {
      document.getElementById('registerPage').classList.add('active');
      document.getElementById('addSkillPage').classList.remove('active');
      document.getElementById('usersPage').classList.remove('active');
      if (pushState) location.hash = "#register";
    }

    function showAddSkillPage(pushState = true) {
      document.getElementById('registerPage').classList.remove('active');
      document.getElementById('addSkillPage').classList.add('active');
      document.getElementById('usersPage').classList.remove('active');
      displayUsers();
      updateAutocomplete();
      if (pushState) location.hash = "#addskill";
    }

    function showUsersPage(pushState = true) {
      document.getElementById('registerPage').classList.remove('active');
      document.getElementById('addSkillPage').classList.remove('active');
      document.getElementById('usersPage').classList.add('active');
      displayUsersFull();
      if (pushState) location.hash = "#users";
    }

    function displayUsers() {
      let html = '';
      users.forEach(user => {
        html += `<div class="user">
          <b>${user.name}</b> (Discord: ${user.discord})<br>
          <strong>Offers:</strong> <ul>${user.skillsOffered.map(s => `<li>${s.name} - ${s.description}</li>`).join('')}</ul>
          <strong>Wants:</strong> ${user.skillsWanted.join(', ')}
        </div>`;
      });
      document.getElementById('users') && (document.getElementById('users').innerHTML = html || "<i>No users registered yet.</i>");
    }

    function displayUsersFull() {
      let html = '';
      users.forEach(user => {
        html += `<div class="user">
          <b>${user.name}</b> (Discord: ${user.discord})<br>
          <strong>Offers:</strong> <ul>${user.skillsOffered.map(s => `<li>${s.name} - ${s.description}</li>`).join('')}</ul>
          <strong>Wants:</strong> ${user.skillsWanted.join(', ')}
        </div>`;
      });
      document.getElementById('usersFull').innerHTML = html || "<i>No users registered yet.</i>";
    }

    document.getElementById('registerForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('name').value.trim();
      let discord = document.getElementById('discord').value.trim();
      let skillsOfferedInput = document.getElementById('skillsOffered').value.trim();
      let skillsWantedInput = document.getElementById('skillsWanted').value.trim();
      let msg = document.getElementById('registerMsg');
      if (users.some(u => u.name.toLowerCase() === name.toLowerCase())) {
        msg.innerHTML = "<span class='error'>User already exists.</span>";
        return;
      }
      let skillsOffered = skillsOfferedInput.split(',').map(s => {
        let parts = s.split(':');
        return { name: (parts[0] || '').trim(), description: (parts[1] || '').trim() };
      }).filter(s => s.name);
      let skillsWanted = skillsWantedInput.split(',').map(s => s.trim()).filter(s => s);
      users.push({ name, discord, skillsOffered, skillsWanted });
      msg.innerHTML = "<span class='success'>User registered!</span>";
      saveUsers();
      setTimeout(() => { msg.innerHTML = ""; showAddSkillPage(); }, 1000);
    };

    document.getElementById('offerForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('offerUser').value.trim();
      let skill = document.getElementById('offerSkill').value.trim();
      let desc = document.getElementById('offerDesc').value.trim();
      let msg = document.getElementById('offerMsg');
      let user = users.find(u => u.name.toLowerCase() === name.toLowerCase());
      if (user) {
        if (!user.skillsOffered.some(s => s.name.toLowerCase() === skill.toLowerCase())) {
          user.skillsOffered.push({ name: skill, description: desc });
          msg.innerHTML = "<span class='success'>Skill added!</span>";
          saveUsers();
          displayUsers();
          updateAutocomplete();
          this.reset();
        } else {
          msg.innerHTML = "<span class='error'>Skill already exists for this user.</span>";
        }
      } else {
        msg.innerHTML = "<span class='error'>User not found.</span>";
      }
      setTimeout(() => { msg.innerHTML = ""; }, 2000);
    };

    document.getElementById('wantForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('wantUser').value.trim();
      let skill = document.getElementById('wantSkill').value.trim();
      let msg = document.getElementById('wantMsg');
      let user = users.find(u => u.name.toLowerCase() === name.toLowerCase());
      if (user) {
        if (!user.skillsWanted.includes(skill)) user.skillsWanted.push(skill);
        msg.innerHTML = "<span class='success'>Skill added!</span>";
        saveUsers();
        displayUsers();
        this.reset();
      } else {
        msg.innerHTML = "<span class='error'>User not found.</span>";
      }
      setTimeout(() => { msg.innerHTML = ""; }, 2000);
    };

    function updateAutocomplete() {
      let allSkills = [];
      users.forEach(u => u.skillsOffered.forEach(s => {
        if (!allSkills.includes(s.name)) allSkills.push(s.name);
      }));
      if (document.getElementById('searchSkill')) {
        autocomplete(document.getElementById('searchSkill'), allSkills);
      }
    }

    function autocomplete(inp, arr) {
      let currentFocus;
      inp.addEventListener("input", function(e) {
        let a, b, i, val = this.value;
        closeAllLists();
        if (!val) { return false;}
        currentFocus = -1;
        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        this.parentNode.appendChild(a);
        for (i = 0; i < arr.length; i++) {
          if (arr[i].toLowerCase().indexOf(val.toLowerCase()) !== -1) {
            b = document.createElement("DIV");
            b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
            b.innerHTML += arr[i].substr(val.length);
            b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
            b.addEventListener("click", function(e) {
                inp.value = this.getElementsByTagName("input")[0].value;
                closeAllLists();
            });
            a.appendChild(b);
          }
        }
      });
      inp.addEventListener("keydown", function(e) {
        let x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
          currentFocus++;
          addActive(x);
        } else if (e.keyCode == 38) {
          currentFocus--;
          addActive(x);
        } else if (e.keyCode == 13) {
          e.preventDefault();
          if (currentFocus > -1) {
            if (x) x[currentFocus].click();
          }
        }
      });
      function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
        for (let i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
        let x = document.getElementsByClassName("autocomplete-items");
        for (let i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
            x[i].parentNode.removeChild(x[i]);
          }
        }
      }
      document.addEventListener("click", function (e) {
        closeAllLists(e.target);
      });
    }

    function searchSkill() {
      let skill = document.getElementById('searchSkill').value.trim();
      let resultDiv = document.getElementById('searchResult');
      let foundUsers = users.filter(user =>
        user.skillsOffered.some(s => s.name.toLowerCase() === skill.toLowerCase())
      );
      if (foundUsers.length > 0) {
        resultDiv.innerHTML = foundUsers.map(user =>
          `<div class="user">
            <b>${user.name}</b> (Discord: ${user.discord})<br>
            <strong>Offers:</strong> <ul>${user.skillsOffered.map(s => `<li>${s.name} - ${s.description}</li>`).join('')}</ul>
            <strong>Wants:</strong> ${user.skillsWanted.join(', ')}
          </div>`
        ).join('');
      } else {
        resultDiv.innerHTML = "<span class='error'>No users found offering that skill.</span>";
      }
    }

    document.getElementById('showAllUsersBtn').onclick = function() {
      showUsersPage();
    };

    document.getElementById('usersBackBtn').onclick = function() {
      showAddSkillPage();
    };

    document.getElementById('titleLink').onclick = function() {
      showAddSkillPage();
    };
    document.getElementById('titleLink2').onclick = function() {
      showAddSkillPage();
    };
    document.getElementById('titleLink3').onclick = function() {
      showAddSkillPage();
    };

    function handleHash() {
      if (location.hash === "#register") {
        showRegisterPage(false);
      } else if (location.hash === "#users") {
        showUsersPage(false);
      } else if (location.hash === "#addskill") {
        showAddSkillPage(false);
      } else {
        showRegisterPage(false); // Always show register page first if no hash
      }
    }

    window.addEventListener('hashchange', handleHash);

    loadUsers();
    updateAutocomplete();
    handleHash();
  </script>
</body>
</html>