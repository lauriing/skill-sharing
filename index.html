<!DOCTYPE html>
<html>
<head>
  <title>Individualis - Skill Sharing Platform</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/html5up-stellar/1.0.0/assets/css/main.css" />
  <style>
    .centered-form {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
    }
    .form-label {
      font-weight: bold;
      margin-bottom: 0.2em;
      display: block;
    }
    .form-group {
      margin-bottom: 1em;
      width: 100%;
      max-width: 350px;
    }
    .user { border: 1px solid #e5e5e5; border-radius: 8px; padding: 1em; margin-bottom: 1em; background: #fff; }
    .matches { background: #f5f5f5; border-radius: 8px; padding: 1em; }
    .success { color: #27ae60; }
    .error { color: #c0392b; }
    .pointer { cursor: pointer; }
    #registerPage, #homePage { display: none; }
    #registerPage.active, #homePage.active { display: block; }
    .autocomplete-items {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      top: 100%;
      left: 0;
      right: 0;
      background: #fff;
      max-height: 150px;
      overflow-y: auto;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }
    .autocomplete-items div:hover {
      background-color: #e9e9e9;
    }
    .autocomplete-active {
      background-color: #1e90ff !important;
      color: #ffffff;
    }
  </style>
</head>
<body class="is-preload">
  <!-- Header -->
  <header id="header" class="center pointer" onclick="showHomePage()">
    <h1 style="cursor:pointer;">Individualis</h1>
    <p>You give skill, I take your skill</p>
  </header>

  <!-- Register Page -->
  <div id="registerPage" class="centered-form active">
    <form id="registerForm" style="width:100%;max-width:400px;">
      <div class="form-group">
        <label class="form-label" for="name">Name:</label>
        <input type="text" id="name" required class="input" />
      </div>
      <div class="form-group">
        <label class="form-label" for="discord">Discord Username:</label>
        <input type="text" id="discord" required class="input" />
      </div>
      <div class="form-group">
        <label class="form-label" for="skillsOffered">What skills do you offer?</label>
        <input type="text" id="skillsOffered" placeholder="e.g. Java:Can teach basics, Python:Data analysis" required class="input" />
      </div>
      <div class="form-group">
        <label class="form-label" for="skillsWanted">What skills do you want to learn from others?</label>
        <input type="text" id="skillsWanted" placeholder="e.g. Python, HTML, CSS" required class="input" />
      </div>
      <button type="submit" class="button primary fit">Register</button>
      <div id="registerMsg"></div>
    </form>
  </div>

  <!-- Home Page -->
  <div id="homePage">
    <section class="container">
      <div class="row gtr-150">
        <div class="col-6 col-12-medium">

          <!-- Add Skill Offered -->
          <section class="section">
            <h2>Add Skill Offered</h2>
            <form id="offerForm">
              <div class="row gtr-uniform">
                <div class="col-4">
                  <input type="text" id="offerUser" placeholder="User Name" required />
                </div>
                <div class="col-4">
                  <input type="text" id="offerSkill" placeholder="Skill" required />
                </div>
                <div class="col-4">
                  <input type="text" id="offerDesc" placeholder="Skill Description" required />
                </div>
                <div class="col-12">
                  <button type="submit" class="button fit">Add</button>
                </div>
              </div>
            </form>
            <div id="offerMsg"></div>
          </section>

          <!-- Add Skill Wanted -->
          <section class="section">
            <h2>Add Skill Wanted</h2>
            <form id="wantForm">
              <div class="row gtr-uniform">
                <div class="col-6">
                  <input type="text" id="wantUser" placeholder="User Name" required />
                </div>
                <div class="col-6">
                  <input type="text" id="wantSkill" placeholder="Skill" required />
                </div>
                <div class="col-12">
                  <button type="submit" class="button fit">Add</button>
                </div>
              </div>
            </form>
            <div id="wantMsg"></div>
          </section>

        </div>
        <div class="col-6 col-12-medium">

          <!-- Search Skill (with autocomplete) -->
          <section class="section">
            <h2>Search Skill</h2>
            <div style="position:relative;">
              <input type="text" id="searchSkill" placeholder="Enter skill" autocomplete="off" />
              <button onclick="searchSkill()" class="button small" type="button">Search</button>
              <div id="autocomplete-list" class="autocomplete-items"></div>
            </div>
            <div id="searchResult"></div>
          </section>

          <!-- Find Matches -->
          <section class="section">
            <h2>Find Matches</h2>
            <button onclick="findMatches()" class="button small">Find Matches</button>
            <div id="matches" class="matches"></div>
          </section>

          <!-- All Users -->
          <section class="section">
            <h2>All Users</h2>
            <div id="users"></div>
          </section>

        </div>
      </div>
    </section>
  </div>

  <!-- Footer -->
  <footer id="footer" class="center">
    <ul class="icons">
      <li><a href="https://html5up.net/stellar" target="_blank" class="icon brands fa-html5"><span class="label"></span></a></li>
      <li><a href="https://github.com/" target="_blank" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
    </ul>
    <p>&copy; Genius Society. Design: Lauri <a href="https://html5up.net/stellar"></a></p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5up-stellar/1.0.0/assets/js/main.js"></script>
  <script>
    let users = [];

    function saveUsers() {
      localStorage.setItem('skillSharingUsers', JSON.stringify(users));
    }

    function loadUsers() {
      const data = localStorage.getItem('skillSharingUsers');
      users = data ? JSON.parse(data) : [];
    }

    function showRegisterPage() {
      document.getElementById('registerPage').classList.add('active');
      document.getElementById('homePage').classList.remove('active');
    }

    function showHomePage() {
      document.getElementById('registerPage').classList.remove('active');
      document.getElementById('homePage').classList.add('active');
      displayUsers();
      updateAutocomplete();
    }

    function displayUsers() {
      let html = '';
      users.forEach(user => {
        html += `<div class="user">
          <b>${user.name}</b> (Discord: ${user.discord})<br>
          <strong>Offers:</strong> <ul>${user.skillsOffered.map(s => `<li>${s.name} - ${s.description}</li>`).join('')}</ul>
          <strong>Wants:</strong> ${user.skillsWanted.join(', ')}
        </div>`;
      });
      document.getElementById('users').innerHTML = html || "<i>No users registered yet.</i>";
    }

    document.getElementById('registerForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('name').value.trim();
      let discord = document.getElementById('discord').value.trim();
      let skillsOfferedInput = document.getElementById('skillsOffered').value.trim();
      let skillsWantedInput = document.getElementById('skillsWanted').value.trim();
      let msg = document.getElementById('registerMsg');
      if (users.some(u => u.name.toLowerCase() === name.toLowerCase())) {
        msg.innerHTML = "<span class='error'>User already exists.</span>";
        return;
      }
      // Parse skills offered as "Skill:Description, Skill2:Description2"
      let skillsOffered = skillsOfferedInput.split(',').map(s => {
        let parts = s.split(':');
        return { name: (parts[0] || '').trim(), description: (parts[1] || '').trim() };
      }).filter(s => s.name);
      let skillsWanted = skillsWantedInput.split(',').map(s => s.trim()).filter(s => s);
      users.push({ name, discord, skillsOffered, skillsWanted });
      msg.innerHTML = "<span class='success'>User registered!</span>";
      saveUsers();
      setTimeout(() => { msg.innerHTML = ""; showHomePage(); }, 1000);
    };

    document.getElementById('offerForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('offerUser').value.trim();
      let skill = document.getElementById('offerSkill').value.trim();
      let desc = document.getElementById('offerDesc').value.trim();
      let msg = document.getElementById('offerMsg');
      let user = users.find(u => u.name.toLowerCase() === name.toLowerCase());
      if (user) {
        if (!user.skillsOffered.some(s => s.name.toLowerCase() === skill.toLowerCase())) {
          user.skillsOffered.push({ name: skill, description: desc });
          msg.innerHTML = "<span class='success'>Skill added!</span>";
          saveUsers();
          displayUsers();
          updateAutocomplete();
          this.reset();
        } else {
          msg.innerHTML = "<span class='error'>Skill already exists for this user.</span>";
        }
      } else {
        msg.innerHTML = "<span class='error'>User not found.</span>";
      }
      setTimeout(() => { msg.innerHTML = ""; }, 2000);
    };

    document.getElementById('wantForm').onsubmit = function(e) {
      e.preventDefault();
      let name = document.getElementById('wantUser').value.trim();
      let skill = document.getElementById('wantSkill').value.trim();
      let msg = document.getElementById('wantMsg');
      let user = users.find(u => u.name.toLowerCase() === name.toLowerCase());
      if (user) {
        if (!user.skillsWanted.includes(skill)) user.skillsWanted.push(skill);
        msg.innerHTML = "<span class='success'>Skill added!</span>";
        saveUsers();
        displayUsers();
        this.reset();
      } else {
        msg.innerHTML = "<span class='error'>User not found.</span>";
      }
      setTimeout(() => { msg.innerHTML = ""; }, 2000);
    };

    // --- AUTOCOMPLETE FOR SEARCH SKILL ---
    function updateAutocomplete() {
      let allSkills = [];
      users.forEach(u => u.skillsOffered.forEach(s => {
        if (!allSkills.includes(s.name)) allSkills.push(s.name);
      }));
      autocomplete(document.getElementById('searchSkill'), allSkills);
    }

    function autocomplete(inp, arr) {
      let currentFocus;
      inp.addEventListener("input", function(e) {
        let a, b, i, val = this.value;
        closeAllLists();
        if (!val) { return false;}
        currentFocus = -1;
        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        this.parentNode.appendChild(a);
        for (i = 0; i < arr.length; i++) {
          if (arr[i].toLowerCase().indexOf(val.toLowerCase()) !== -1) {
            b = document.createElement("DIV");
            b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
            b.innerHTML += arr[i].substr(val.length);
            b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
            b.addEventListener("click", function(e) {
                inp.value = this.getElementsByTagName("input")[0].value;
                closeAllLists();
            });
            a.appendChild(b);
          }
        }
      });
      inp.addEventListener("keydown", function(e) {
        let x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
          currentFocus++;
          addActive(x);
        } else if (e.keyCode == 38) {
          currentFocus--;
          addActive(x);
        } else if (e.keyCode == 13) {
          e.preventDefault();
          if (currentFocus > -1) {
            if (x) x[currentFocus].click();
          }
        }
      });
      function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
        for (let i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
        let x = document.getElementsByClassName("autocomplete-items");
        for (let i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
            x[i].parentNode.removeChild(x[i]);
          }
        }
      }
      document.addEventListener("click", function (e) {
        closeAllLists(e.target);
      });
    }

    function searchSkill() {
      let skill = document.getElementById('searchSkill').value.trim();
      let resultDiv = document.getElementById('searchResult');
      let foundUsers = users.filter(user =>
        user.skillsOffered.some(s => s.name.toLowerCase() === skill.toLowerCase())
      );
      if (foundUsers.length > 0) {
        resultDiv.innerHTML = foundUsers.map(user =>
          `<div class="user">
            <b>${user.name}</b> (Discord: ${user.discord})<br>
            <strong>Offers:</strong> <ul>${user.skillsOffered.map(s => `<li>${s.name} - ${s.description}</li>`).join('')}</ul>
            <strong>Wants:</strong> ${user.skillsWanted.join(', ')}
          </div>`
        ).join('');
      } else {
        resultDiv.innerHTML = "<span class='error'>No users found offering that skill.</span>";
      }
    }

    function findMatches() {
      let html = '';
      let found = false;
      users.forEach(seeker => {
        seeker.skillsWanted.forEach(wanted => {
          users.forEach(provider => {
            if (provider !== seeker && provider.skillsOffered.some(s => s.name.toLowerCase() === wanted.toLowerCase())) {
              html += `<div><b>${seeker.name}</b> wants <strong>${wanted}</strong> - Match: <b>${provider.name}</b></div>`;
              found = true;
            }
          });
        });
      });
      document.getElementById('matches').innerHTML = found ? html : "<i>No matches found.</i>";
    }

    // On load
    loadUsers();
    showRegisterPage();
    updateAutocomplete();
  </script>
</body>
</html>